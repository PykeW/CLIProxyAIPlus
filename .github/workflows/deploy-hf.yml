name: Sync to Hugging Face Hub

on:
  push:
    branches: [main]
  workflow_dispatch:

jobs:
  sync-to-hub:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4
        with:
          fetch-depth: 0
          lfs: true

      - name: Push to hub
        env:
          HF_TOKEN: ${{ secrets.HF_TOKEN }}
          # æ ¼å¼: ä½ çš„HFç”¨æˆ·å/ä½ çš„Spaceåå­—
          # å»ºè®®åœ¨ Secrets ä¸­è®¾ç½® HF_SPACE_NAMEï¼Œæˆ–è€…ç›´æ¥åœ¨è¿™é‡Œä¿®æ”¹
          HF_SPACE_NAME: ${{ secrets.HF_SPACE_NAME }}
        run: |
          if [ -z "$HF_SPACE_NAME" ]; then
            echo "Error: HF_SPACE_NAME secret is not set."
            echo "Please set HF_SPACE_NAME in GitHub Secrets (e.g., 'username/space-name')."
            exit 1
          fi

          # -------------------------------------------------------------------------
          # å½»åº•é‡æ„æ¨é€é€»è¾‘ï¼šé‡å»º Git ä»“åº“ä»¥æ¸…é™¤æ‰€æœ‰å†å²å’Œå¤§æ–‡ä»¶
          # -------------------------------------------------------------------------

          # 1. å‡†å¤‡æ–‡ä»¶
          mv Dockerfile.hf Dockerfile
          # åˆ é™¤ä¸éœ€è¦çš„ç›®å½•å’Œæ–‡ä»¶
          rm -rf asset/ad .git

          # 2. åˆå§‹åŒ–å…¨æ–°çš„ Git ä»“åº“
          git init
          git config --global user.email "action@github.com"
          git config --global user.name "GitHub Action"

          # 3. ç”Ÿæˆ Hugging Face å¿…éœ€çš„ README.md é…ç½®
          # æ³¨æ„ï¼šå¿…é¡»åŒ…å« sdk: docker
          echo "---" > README.md
          echo "title: CLIProxyAIPlus" >> README.md
          echo "emoji: ğŸš€" >> README.md
          echo "colorFrom: blue" >> README.md
          echo "colorTo: purple" >> README.md
          echo "sdk: docker" >> README.md
          echo "pinned: false" >> README.md
          echo "---" >> README.md
          # è¿½åŠ åŸæœ¬çš„ README å†…å®¹ (å¯é€‰ï¼Œè¿™é‡Œä¸ºäº†ç®€å•ç›´æ¥è¦†ç›–ï¼Œé¿å…æ ¼å¼å†²çª)
          echo "" >> README.md
          echo "# CLIProxyAI Plus on Hugging Face" >> README.md

          # 4. æ·»åŠ æ‰€æœ‰æ–‡ä»¶
          git add .
          git commit -m "Deploy to Hugging Face"

          # 4. å¼ºåˆ¶æ¨é€ (è¦†ç›– HF ä¸Šçš„æ‰€æœ‰å†…å®¹)
          echo "Pushing to Hugging Face Space: $HF_SPACE_NAME"
          git push https://oauth2:$HF_TOKEN@huggingface.co/spaces/$HF_SPACE_NAME master:main --force
